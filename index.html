<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mini OSM Directions</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        body {
            font-family: "Ubuntu", sans-serif;
        }

        #map {
            height: 80vh;
            border-radius: 1rem;
        }

        .rounder {
            border-radius: 0.75rem;
        }
    </style>
</head>

<body class="p-4 bg-gray-100">
    <div class="flex gap-2 mb-3">
        <input id="start" class="p-2 border rounder w-1/3" placeholder="Start: lon,lat">
        <input id="end" class="p-2 border rounder w-1/3" placeholder="End: lon,lat">
        <button id="go" class="p-2 px-4 bg-blue-600 text-white rounder shadow">Route</button>
    </div>

    <div id="map" class="shadow-lg"></div>

    <script>
        // --- Map ---
        const map = L.map("map").setView([38, -97], 4);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19, attribution: "&copy; OSM"
        }).addTo(map);

        let routeLayer;
        let clickStep = 0; // 0 = next click sets Start, 1 = sets End

        // --- Click to fill coordinates ---
        map.on("click", e => {
            const { lat, lng } = e.latlng;
            const val = `${lng.toFixed(6)},${lat.toFixed(6)}`;

            if (clickStep === 0) {
                document.getElementById("start").value = val;
                clickStep = 1;
            } else {
                document.getElementById("end").value = val;
                clickStep = 0;
            }
        });

        // --- Routing ---
        async function route() {
            const s = document.getElementById("start").value.split(",");
            const e = document.getElementById("end").value.split(",");
            if (s.length !== 2 || e.length !== 2) return;

            const url =
                `https://router.project-osrm.org/route/v1/driving/` +
                `${s[0]},${s[1]};${e[0]},${e[1]}?overview=full&geometries=geojson`;

            const res = await fetch(url);
            const json = await res.json();
            if (!json.routes?.length) return;

            const coords = json.routes[0].geometry.coordinates.map(([x, y]) => [y, x]);

            if (routeLayer) map.removeLayer(routeLayer);
            routeLayer = L.polyline(coords, { color: "blue", weight: 4 }).addTo(map);

            map.fitBounds(routeLayer.getBounds(), { padding: [20, 20] });
        }

        document.getElementById("go").onclick = route;
    </script>

</body>

</html>
